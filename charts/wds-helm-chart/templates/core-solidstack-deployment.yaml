{{- if eq .Values.global.coreServices.mode "SingleService" }}
  {{- $env := list
    (dict "name" "DB_CONNECTION_STRING" "value" .Values.global.coreServices.databases.mongodb.connectionString)
    (dict "name" "JOB_TYPES" "value" (join "," .Values.global.coreServices.jobTypes))
    (dict "name" "EXTERNAL_IP_ADDRESS_CONFIGS" "value" (join "," .Values.global.coreServices.externalIpConfigs))
    (dict "name" "MIN_LOG_LEVEL" "value" .Values.global.minLogLevel)
    (dict "name" "BASE_PATH" "value" .Values.global.ingress.basePath)
  }}
  {{- if .Values.global.coreServices.exceptionResponseDelayMs }}
    {{- $env = append $env (dict "name" "GLOBAL_EXCEPTION_RESPONSE_DELAY_MS" "value" .Values.global.coreServices.exceptionResponseDelayMs) }}
  {{- end }}

  {{ include "wds-helm-chart.deployment" (dict
    "ctx" .
    "name" "solidstack"
    "labels" (merge (default (dict) .Values.coreServices.solidstack.deploymentExtraLabelsOverride) (default (dict) .Values.global.deploymentExtraLabels))
    "replicas" (.Values.coreServices.solidstack.replicaCount | default 1)
    "nodeSelector" (.Values.coreServices.solidstack.nodeSelectorOverride | default .Values.global.nodeSelector)
    "tolerations" (.Values.coreServices.solidstack.tolerationsOverride | default .Values.global.tolerations)
    "affinity" (.Values.coreServices.solidstack.affinityOverride | default .Values.global.affinity)
    "containers" (list
      (dict
        "name" "solidstack"
        "registry" .Values.global.registry
        "image" (.Values.coreServices.solidstack.image.name | default "webdatasource/solidstack")
        "tag" (.Values.coreServices.solidstack.image.tag | default .Chart.AppVersion)
        "imagePullPolicy" .Values.coreServices.solidstack.image.pullPolicy
        "ports" (list (dict "name" "http" "containerPort" 8080))
        "env" $env
      )
    )
  ) }}
{{- end }}
