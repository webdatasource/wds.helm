suite: test playground ext service
templates:
  - auxiliary-palyground-ext-service.yaml

tests:
  - it: should not render when disabled
    set:
      global.auxiliaryServices.playground.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should render with defaults
    asserts:
      - isKind:
          of: Service
      - equal:
          path: spec.ports[0].name
          value: http-ext
      - equal:
          path: spec.ports[0].port
          value: 80
      - equal:
          path: spec.ports[0].protocol
          value: TCP
      - equal:
          path: spec.selector.app
          value: playground
      - equal:
          path: metadata.labels.app
          value: playground

  - it: should merge global and service serviceExtraLabels
    set:
      global.serviceExtraLabels:
        globalLabel: g
        common: global
      auxiliaryServices.playground.serviceExtraLabelsOverride:
        serviceLabel: s
        common: service
    asserts:
      - equal:
          path: metadata.labels.globalLabel
          value: g
      - equal:
          path: metadata.labels.serviceLabel
          value: s
      - equal:
          path: metadata.labels.common
          value: service

  - it: should have correct port configuration
    asserts:
      - equal:
          path: spec.ports[0].name
          value: http-ext
      - equal:
          path: spec.ports[0].port
          value: 80
      - equal:
          path: spec.ports[0].protocol
          value: TCP
